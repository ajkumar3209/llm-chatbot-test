"""
DEPLOYMENT INSTRUCTIONS - When you're back in office
Run these exact commands on the Ubuntu server
"""

STEP 1: Upload files from your local machine to server
========================================================

# From your local Windows machine in PowerShell:

scp -i "C:\Users\aryan.gupta\Downloads\acebuddy.key" PRODUCTION_zoho_api_simple.py ubuntu@45.194.90.181:/tmp/zoho_api_simple.py

scp -i "C:\Users\aryan.gupta\Downloads\acebuddy.key" llm_chatbot.py ubuntu@45.194.90.181:/tmp/llm_chatbot.py


STEP 2: SSH to server and deploy
=================================

ssh -i "C:\Users\aryan.gupta\Downloads\acebuddy.key" ubuntu@45.194.90.181

# On the server, run these commands:

sudo cp /tmp/zoho_api_simple.py /opt/llm-chatbot/zoho_api_simple.py

sudo cp /tmp/llm_chatbot.py /opt/llm-chatbot/llm_chatbot.py

sudo systemctl restart llm-chatbot.service

sleep 5

sudo systemctl status llm-chatbot.service --no-pager

sudo journalctl -u llm-chatbot -n 30 --no-pager


STEP 3: Verify everything is working
=====================================

Check these logs appear:
- [SalesIQ] ✓ ENABLED
- [Desk] ✓ ENABLED
- Zoho API loaded successfully

If you see errors, provide the error logs and I'll debug.


KEY DIFFERENCES IN PRODUCTION CODE:
===================================

1. TRANSFER (Chat to Agent):
   - Uses SALESIQ_VISITOR_ACCESS_TOKEN and SALESIQ_VISITOR_REFRESH_TOKEN
   - If token expires (401/403), auto-refreshes using SALESIQ_VISITOR_CLIENT_ID/SECRET
   - Retries the transfer immediately after refresh
   - Endpoint: https://salesiq.zoho.in/api/visitor/v1/rtdsportal/conversations

2. CALLBACK (Schedule Callback):
   - Uses DESK_ACCESS_TOKEN and DESK_REFRESH_TOKEN
   - First creates a contact, then creates a call
   - If token expires, auto-refreshes using DESK_CLIENT_ID/SECRET
   - Retries after refresh
   - Endpoint: https://desk.zoho.in/api/v1/calls

3. CLOSURE (Close Chat):
   - Uses SALESIQ_ACCESS_TOKEN and SALESIQ_REFRESH_TOKEN
   - When user says "issue resolved", closes the chat via API
   - If token expires, auto-refreshes using SALESIQ_CLIENT_ID/SECRET
   - Endpoint: https://salesiq.zoho.in/api/v2/rtdsportal/conversations/{id}/close

All three operations have comprehensive error logging.
"""

# The files you need to deploy:
# 1. PRODUCTION_zoho_api_simple.py -> Copy to /opt/llm-chatbot/zoho_api_simple.py
# 2. llm_chatbot.py -> Copy to /opt/llm-chatbot/llm_chatbot.py

# These have the EXACT working logic verified locally
