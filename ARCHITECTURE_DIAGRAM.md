# ğŸ—ï¸ Complete Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                          END USER'S BROWSER                                 â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚                    YOUR WEBSITE                                       â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚         Zoho SalesIQ Chat Widget                            â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  User: "How do I fix QuickBooks error -6189?"              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTPS Webhook
                                    â”‚ POST /webhook
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                          N8N WORKFLOW ENGINE                                â”‚
â”‚                      (Middleware / Orchestration)                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             â”‚   â”‚              â”‚   â”‚              â”‚   â”‚             â”‚ â”‚
â”‚  â”‚  Webhook    â”‚â”€â”€â–¶â”‚   Extract    â”‚â”€â”€â–¶â”‚  HTTP Call   â”‚â”€â”€â–¶â”‚  Format &   â”‚ â”‚
â”‚  â”‚  Receiver   â”‚   â”‚   Data       â”‚   â”‚  to Chatbot  â”‚   â”‚  Respond    â”‚ â”‚
â”‚  â”‚             â”‚   â”‚              â”‚   â”‚              â”‚   â”‚             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  Extracts:                         Sends:                                  â”‚
â”‚  â€¢ session_id (visitor_id)         â€¢ session_id                            â”‚
â”‚  â€¢ message (user query)            â€¢ message                               â”‚
â”‚  â€¢ visitor_name                    â€¢ conversation_history                  â”‚
â”‚  â€¢ visitor_email                                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTP POST
                                    â”‚ http://your-server:8000/chat
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                    FASTAPI CHATBOT SERVER (Port 8000)                       â”‚
â”‚                         (Your RAG Application)                              â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  POST /chat                                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Receives: session_id + message                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ Checks conversation memory                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ Detects: New issue or continuation?                              â”‚ â”‚
â”‚  â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ IF NEW ISSUE:                                                    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Generate query embedding (OpenAI)                            â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Search Pinecone (vector similarity)                          â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€ Retrieve top 3 KB articles                                   â”‚ â”‚
â”‚  â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ Build context from retrieved docs                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ Generate response (GPT-4o-mini)                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ Update conversation memory                                       â”‚ â”‚
â”‚  â”‚  â””â”€ Return: response + metadata                                      â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  Other Endpoints:                                                           â”‚
â”‚  â€¢ GET  /health  - Health check                                            â”‚
â”‚  â€¢ GET  /sessions - List active sessions                                   â”‚
â”‚  â€¢ POST /reset/{session_id} - Reset conversation                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                    â”‚
                    â”‚                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚            â”‚                      â”‚
        â†“                      â†“            â†“                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚  PINECONE API    â”‚  â”‚  OPENAI API      â”‚  â”‚  OPENAI API      â”‚
â”‚  (Vector Search) â”‚  â”‚  (Embeddings)    â”‚  â”‚  (GPT-4o-mini)   â”‚
â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚  Index:          â”‚  â”‚  Model:          â”‚  â”‚  Model:          â”‚
â”‚  support-chatbot â”‚  â”‚  text-embedding  â”‚  â”‚  gpt-4o-mini     â”‚
â”‚                  â”‚  â”‚  -3-small        â”‚  â”‚                  â”‚
â”‚  Vectors: 5,487  â”‚  â”‚                  â”‚  â”‚  Purpose:        â”‚
â”‚  Dimension: 1536 â”‚  â”‚  Purpose:        â”‚  â”‚  Generate        â”‚
â”‚                  â”‚  â”‚  Convert query   â”‚  â”‚  conversational  â”‚
â”‚  Content:        â”‚  â”‚  to vector       â”‚  â”‚  response        â”‚
â”‚  â€¢ 216 KB/SOP    â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚  â€¢ 5,271 chats   â”‚  â”‚  Cost:           â”‚  â”‚  Cost:           â”‚
â”‚                  â”‚  â”‚  $0.00001/query  â”‚  â”‚  $0.001/response â”‚
â”‚  Cost:           â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚  Free tier       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Example

### User Query: "How do I fix QuickBooks error -6189?"

```
STEP 1: User sends message via SalesIQ widget
â”œâ”€ Browser â†’ Zoho SalesIQ servers
â””â”€ Zoho triggers webhook to n8n

STEP 2: n8n receives webhook
â”œâ”€ Extracts: session_id="visitor_12345", message="How do I fix..."
â”œâ”€ Formats request
â””â”€ Sends HTTP POST to FastAPI server

STEP 3: FastAPI server processes request
â”œâ”€ Checks if new issue: YES (first message)
â”œâ”€ Generates embedding: [0.023, -0.015, 0.041, ...] (1536 dims)
â”œâ”€ Searches Pinecone: Finds 3 relevant KB articles
â”‚   1. "How to fix QuickBooks Error -6189" (score: 0.815)
â”‚   2. "How to fix QuickBooks Error -6189" (score: 0.794)
â”‚   3. "Fix QuickBooks Error -6177" (score: 0.733)
â”œâ”€ Builds context from retrieved articles
â”œâ”€ Sends to GPT-4o-mini with prompt:
â”‚   "You are a support assistant. Use these KB articles to guide
â”‚    the user step-by-step. Show only 1-2 steps at a time..."
â””â”€ GPT-4o-mini generates response

STEP 4: Response generated
â”œâ”€ "Let's fix this together. First:
â”‚   1. Close QuickBooks completely
â”‚   2. Open QuickBooks Tool Hub
â”‚   Have you completed these steps?"
â”œâ”€ Saves to conversation memory
â””â”€ Returns to n8n

STEP 5: n8n formats and sends back
â”œâ”€ Formats response for SalesIQ
â””â”€ Sends to Zoho webhook response

STEP 6: User sees response in chat widget
â””â”€ "Let's fix this together. First: 1. Close QuickBooks..."
```

---

## Conversation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TURN 1: Initial Query                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User: "How do I fix QuickBooks error -6189?"                    â”‚
â”‚                                                                 â”‚
â”‚ System:                                                         â”‚
â”‚ â”œâ”€ Detects: NEW ISSUE                                          â”‚
â”‚ â”œâ”€ Retrieves: 3 KB articles from Pinecone                      â”‚
â”‚ â””â”€ Generates: First 1-2 steps only                             â”‚
â”‚                                                                 â”‚
â”‚ Bot: "Let's fix this together. First:                          â”‚
â”‚       1. Close QuickBooks completely                            â”‚
â”‚       2. Open QuickBooks Tool Hub                               â”‚
â”‚       Have you completed these steps?"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TURN 2: User Confirmation                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User: "Yes, I've done that"                                     â”‚
â”‚                                                                 â”‚
â”‚ System:                                                         â”‚
â”‚ â”œâ”€ Detects: CONTINUATION (short response, "yes")               â”‚
â”‚ â”œâ”€ Uses: Existing context (no new retrieval)                   â”‚
â”‚ â”œâ”€ Remembers: User completed steps 1-2                         â”‚
â”‚ â””â”€ Generates: Next 1-2 steps                                   â”‚
â”‚                                                                 â”‚
â”‚ Bot: "Great! Now:                                              â”‚
â”‚       3. Click on 'Program Issues'                              â”‚
â”‚       4. Select 'Quick Fix my Program'                          â”‚
â”‚       Did this work?"                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TURN 3: Progress Update                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User: "It's running now"                                        â”‚
â”‚                                                                 â”‚
â”‚ System:                                                         â”‚
â”‚ â”œâ”€ Detects: CONTINUATION                                       â”‚
â”‚ â”œâ”€ Understands: User is making progress                        â”‚
â”‚ â””â”€ Generates: Next steps                                       â”‚
â”‚                                                                 â”‚
â”‚ Bot: "Perfect! Once it completes:                              â”‚
â”‚       5. Close the Tool Hub                                     â”‚
â”‚       6. Try opening your company file                          â”‚
â”‚       Let me know if it works!"                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TURN 4: Resolution                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User: "Yes! It's working now. Thank you!"                       â”‚
â”‚                                                                 â”‚
â”‚ System:                                                         â”‚
â”‚ â”œâ”€ Detects: RESOLUTION (positive sentiment)                    â”‚
â”‚ â””â”€ Generates: Congratulations + offer more help                â”‚
â”‚                                                                 â”‚
â”‚ Bot: "Excellent! I'm so glad the error is resolved. ğŸ‰         â”‚
â”‚       If you need anything else, feel free to ask!"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cost Breakdown Per Conversation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONVERSATION: 6 turns (typical)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚ Turn 1 (New Issue):                                             â”‚
â”‚ â”œâ”€ Query embedding:     $0.000001                              â”‚
â”‚ â”œâ”€ Pinecone search:     $0.000000 (free tier)                  â”‚
â”‚ â”œâ”€ Response generation: $0.001000                              â”‚
â”‚ â””â”€ Subtotal:            $0.001001                              â”‚
â”‚                                                                 â”‚
â”‚ Turn 2-6 (Continuations): Ã— 5                                   â”‚
â”‚ â”œâ”€ No embedding needed (continuation)                          â”‚
â”‚ â”œâ”€ No Pinecone search (uses cached context)                    â”‚
â”‚ â”œâ”€ Response generation: $0.001000 Ã— 5                          â”‚
â”‚ â””â”€ Subtotal:            $0.005000                              â”‚
â”‚                                                                 â”‚
â”‚ TOTAL PER CONVERSATION: $0.006                                  â”‚
â”‚                                                                 â”‚
â”‚ For 1,000 conversations/month:                                  â”‚
â”‚ â””â”€ Total cost: $6.00/month                                      â”‚
â”‚                                                                 â”‚
â”‚ Plus infrastructure:                                            â”‚
â”‚ â”œâ”€ Pinecone: $0 (free tier)                                    â”‚
â”‚ â”œâ”€ n8n: $0 (self-hosted)                                       â”‚
â”‚ â””â”€ Server: $5-20/month                                          â”‚
â”‚                                                                 â”‚
â”‚ GRAND TOTAL: $11-26/month for 1,000 conversations              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Options

### Option 1: All Local (Development/Testing)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Your Computer                            â”‚
â”‚                                          â”‚
â”‚ â”œâ”€ FastAPI Server (localhost:8000)      â”‚
â”‚ â”œâ”€ n8n (localhost:5678)                 â”‚
â”‚ â””â”€ ngrok (public tunnel)                â”‚
â”‚                                          â”‚
â”‚ Pros: Easy setup, free                  â”‚
â”‚ Cons: Not reliable for production       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Option 2: Hybrid (Recommended for Start)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloud n8n (n8n.cloud)                    â”‚
â”‚ â””â”€ $20/month                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VPS Server (DigitalOcean/AWS)            â”‚
â”‚ â”œâ”€ FastAPI Server                        â”‚
â”‚ â””â”€ $5-20/month                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Option 3: Full Production
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Self-hosted n8n (Docker)                 â”‚
â”‚ â””â”€ Free (on your server)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Production Server                        â”‚
â”‚ â”œâ”€ FastAPI (systemd service)            â”‚
â”‚ â”œâ”€ Redis (conversation cache)           â”‚
â”‚ â”œâ”€ Nginx (reverse proxy)                â”‚
â”‚ â””â”€ SSL certificate                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SECURITY MEASURES                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚ 1. API Keys                                                     â”‚
â”‚    â”œâ”€ Stored in .env file (not in code)                        â”‚
â”‚    â”œâ”€ Never committed to git                                   â”‚
â”‚    â””â”€ Environment variables in production                      â”‚
â”‚                                                                 â”‚
â”‚ 2. Webhook Authentication                                       â”‚
â”‚    â”œâ”€ n8n validates incoming webhooks                          â”‚
â”‚    â”œâ”€ Optional: Add Bearer token                               â”‚
â”‚    â””â”€ IP whitelist (Zoho SalesIQ IPs)                          â”‚
â”‚                                                                 â”‚
â”‚ 3. Rate Limiting                                                â”‚
â”‚    â”œâ”€ FastAPI: 10 requests/minute per IP                       â”‚
â”‚    â”œâ”€ Prevents abuse                                           â”‚
â”‚    â””â”€ Protects API costs                                       â”‚
â”‚                                                                 â”‚
â”‚ 4. Data Privacy                                                 â”‚
â”‚    â”œâ”€ No PII stored in logs                                    â”‚
â”‚    â”œâ”€ Conversation data encrypted                              â”‚
â”‚    â””â”€ GDPR compliant                                            â”‚
â”‚                                                                 â”‚
â”‚ 5. SSL/TLS                                                      â”‚
â”‚    â”œâ”€ HTTPS for all external communication                     â”‚
â”‚    â”œâ”€ Certificate from Let's Encrypt                           â”‚
â”‚    â””â”€ Secure webhook endpoints                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**This architecture is production-ready and scalable to handle 1,000+ conversations/month!**
